(()=>{"use strict";class e{constructor(){this.agreeElement=null,this.processElement=null,this.fields=[{name:"name",id:"name",element:null,regex:/^[а-я]+\s*$/i,valid:!1},{name:"lastName",id:"last-name",element:null,regex:/^[а-я]+\s*$/i,valid:!1},{name:"email",id:"email",element:null,regex:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,valid:!1}];const e=this;this.fields.forEach((t=>{t.element=document.getElementById(t.id),t.element.onchange=function(){e.validateField.call(e,t,this)}})),this.processElement=document.getElementById("process"),this.processElement.onclick=function(){e.processForm()},this.agreeElement=document.getElementById("agree"),this.agreeElement.onchange=function(){e.validateForm()}}validateField(e,t){t.value&&t.value.match(e.regex)?(t.parentNode.removeAttribute("style"),e.valid=!0):(t.parentNode.style.borderColor="red",e.valid=!1),this.validateForm()}validateForm(){const e=this.fields.every((e=>e.valid)),t=this.agreeElement.checked&&e;return t?this.processElement.removeAttribute("disabled"):this.processElement.setAttribute("disabled","disabled"),t}processForm(){this.validateForm()&&(this.fields.forEach((e=>{sessionStorage.setItem(e.name,e.element.value)})),location.href="#/choice")}}class t{static checkUserData(){const e=sessionStorage.getItem("name"),t=sessionStorage.getItem("lastName"),s=sessionStorage.getItem("email");e&&t&&s||(location.href="#/")}static checkUserId(){sessionStorage.getItem("id")||(location.href="#/")}}class s{constructor(){this.quizzes=[],t.checkUserData();const e=new XMLHttpRequest;if(e.open("GET","https://testologia.ru/get-quizzes",!1),e.send(),200===e.status&&e.responseText){try{this.quizzes=JSON.parse(e.responseText)}catch(e){location.href="#/"}this.processQuizzes()}else location.href="#/"}processQuizzes(){const e=document.getElementById("choice__details");this.quizzes&&this.quizzes.length>0&&this.quizzes.forEach((t=>{const s=this,n=document.createElement("div");n.className="choice__group",n.setAttribute("data-id",t.id),n.onclick=function(e){e.preventDefault(),s.chooseQuiz(this)};const i=document.createElement("div");i.className="choice__group-text",i.innerText=t.name;const o=document.createElement("div");o.className="choice__group-arrow";const a=document.createElement("img");a.setAttribute("src","images/arrow.png"),a.setAttribute("alt","arrow"),o.appendChild(a),n.appendChild(i),n.appendChild(o),e.appendChild(n)}))}chooseQuiz(e){const t=e.getAttribute("data-id");t&&(sessionStorage.setItem("id",t),location.href="#/test")}}class n{constructor(){this.quiz=null,this.currentQuestionIndex=1,this.questionTitleElement=null,this.optionsElement=null,this.nextButtonElement=null,this.prevButtonElement=null,this.passButtonElement=null,this.userResult=[],this.exit=[],this.barOptionsElement=null,t.checkUserData(),t.checkUserId();const e=sessionStorage.getItem("id"),s=new XMLHttpRequest;if(s.open("GET","https://testologia.ru/get-quiz?id="+e,!1),s.send(),200===s.status&&s.responseText){try{this.quiz=JSON.parse(s.responseText)}catch(e){location.href="#/"}this.startQuiz()}else location.href="#/"}startQuiz(){this.barOptionsElement=document.getElementById("progress-bar"),this.questionTitleElement=document.getElementById("title"),this.optionsElement=document.getElementById("options"),this.nextButtonElement=document.getElementById("next"),this.nextButtonElement.onclick=this.move.bind(this,"next"),this.passButtonElement=document.getElementById("pass"),this.passButtonElement.onclick=this.move.bind(this,"pass"),document.getElementById("pre-title").innerText=this.quiz.name,this.prevButtonElement=document.getElementById("prev"),this.prevButtonElement.onclick=this.move.bind(this,"prev"),this.prepareProgressBar(),this.showQuestion();const e=document.getElementById("timer");let t=59;const s=setInterval(function(){t--,e.innerText=t,0===t&&(clearInterval(s),this.complete())}.bind(this),1e3)}prepareProgressBar(){for(let e=0;e<this.quiz.questions.length;e++){const t=document.createElement("div");t.className="test__progress-bar-item "+(0===e?"active":"");const s=document.createElement("div");s.className="test__progress-bar-item-circle";const n=document.createElement("div");n.className="test__progress-bar-item-text",n.innerText="Вопрос "+(e+1),t.appendChild(s),t.appendChild(n),this.barOptionsElement.appendChild(t)}}showQuestion(){const e=this.quiz.questions[this.currentQuestionIndex-1];this.questionTitleElement.innerHTML=`<span>Вопрос ${this.currentQuestionIndex}:</span> ${e.question}`,this.optionsElement.innerHTML="";const t=this,s=this.userResult.find((t=>t.questionId===e.id));e.answers.forEach((e=>{const n=document.createElement("div");n.className="test__question-option";const i="answer-"+e.id,o=document.createElement("input");o.className="option-answer",o.setAttribute("id",i),o.setAttribute("type","radio"),o.setAttribute("name","answer"),o.setAttribute("value",e.id),s&&s.chosenAnswerId===e.id&&o.setAttribute("checked","checked"),o.onchange=function(){t.chooseAnswer()};const a=document.createElement("label");a.setAttribute("for",i),a.innerText=e.answer,n.appendChild(o),n.appendChild(a),this.optionsElement.appendChild(n)})),s&&s.chosenAnswerId?(this.nextButtonElement.removeAttribute("disabled"),this.passButtonElement.classList.add("disabled")):(this.nextButtonElement.setAttribute("disabled","disabled"),this.passButtonElement.classList.remove("disabled")),this.currentQuestionIndex===this.quiz.questions.length?this.nextButtonElement.innerText="Завершить":this.nextButtonElement.innerText="Далее",this.currentQuestionIndex>1?this.prevButtonElement.removeAttribute("disabled"):this.prevButtonElement.setAttribute("disabled","disabled")}chooseAnswer(){this.nextButtonElement.removeAttribute("disabled"),this.passButtonElement.classList.add("disabled")}move(e){const t=this.quiz.questions[this.currentQuestionIndex-1],s=Array.from(document.getElementsByClassName("option-answer")).find((e=>e.checked));let n=null;s&&s.value&&(n=Number(s.value));const i=this.userResult.find((e=>e.questionId===t.id));i?i.chosenAnswerId=n:this.userResult.push({questionId:t.id,chosenAnswerId:n}),this.exit.push(n),"next"===e||"pass"===e?this.currentQuestionIndex++:this.currentQuestionIndex--,this.currentQuestionIndex>this.quiz.questions.length?this.complete():(Array.from(this.barOptionsElement.children).forEach(((e,t)=>{const s=t+1;e.classList.remove("active"),e.classList.remove("complete"),s===this.currentQuestionIndex?e.classList.add("active"):s<this.currentQuestionIndex&&e.classList.add("complete")})),this.showQuestion())}complete(){const e=sessionStorage.getItem("name"),t=sessionStorage.getItem("lastName"),s=sessionStorage.getItem("email"),n=Number(sessionStorage.getItem("id")),i=new XMLHttpRequest;if(i.open("POST",`https://testologia.ru/pass-quiz?id=${n}`,!1),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify({name:e,lastName:t,email:s,results:this.userResult})),200===i.status&&i.responseText){let e=null;try{e=JSON.parse(i.responseText)}catch(e){location.href="#/"}e&&(sessionStorage.setItem("exit",this.exit),sessionStorage.setItem("score",e.score),sessionStorage.setItem("total",e.total),location.href="#/result")}else location.href="#/"}}class i{constructor(){let e=sessionStorage.getItem("score")||0,t=sessionStorage.getItem("total")||0;document.getElementById("result__score").innerText=`${e}/${t}`;const s=this;this.getAnswers=document.getElementById("get-answers"),this.getAnswers.onclick=function(){s.checkAnswers()}}checkAnswers(){location.href="#/checking"}}class o{constructor(){this.name=sessionStorage.getItem("name"),this.lastName=sessionStorage.getItem("lastName"),this.email=sessionStorage.getItem("email"),this.questionsContainer=document.getElementById("list-questions");const e=Number(sessionStorage.getItem("id"));this.userAnswers=sessionStorage.getItem("exit").split(",").map(Number);const t=new XMLHttpRequest;if(t.open("GET",`https://testologia.ru/get-quiz?id=${e}`,!1),t.send(),200===t.status&&t.responseText)try{this.quiz=JSON.parse(t.responseText)}catch(e){location.href="#/"}else location.href="#/";const s=new XMLHttpRequest;if(s.open("GET",`https://testologia.ru/get-quiz-right?id=${e}`,!1),s.send(),200===s.status&&s.responseText)try{this.rightAnswers=JSON.parse(s.responseText)}catch(e){location.href="#/"}else location.href="#/";this.listAnswers()}listAnswers(){document.getElementById("test").innerText=this.quiz.name,document.getElementById("data").innerText=`${this.name} ${this.lastName}, ${this.email}`,this.questionsContainer.innerHTML="",this.quiz.questions.forEach(((e,t)=>{const s=document.createElement("div");s.className="answer__question";const n=document.createElement("div");n.className="answers__question-title",n.innerHTML=`<span>Вопрос ${t+1}:</span> ${e.question}`,s.appendChild(n);const i=document.createElement("div");i.className="answers__question-options",e.answers.forEach(((e,s)=>{const n=document.createElement("div");n.className="answers__question-option";const o=`answer-${t+1}-${s+1}`,a=document.createElement("input");a.type="radio",a.id=o,a.name=`answer-${t+1}`,n.appendChild(a);const r=document.createElement("label");r.htmlFor=o,r.innerText=e.answer,n.appendChild(r);const l=this.userAnswers[t],c=this.rightAnswers[t];e.id===l&&(l===c?n.classList.add("right"):n.classList.add("wrong")),i.appendChild(n)})),s.appendChild(i),this.questionsContainer.appendChild(s)}))}}class a{constructor(){this.routes=[{route:"#/",title:"Главная",template:"templates/index.html",styles:"css/index.css",load:()=>{}},{route:"#/registration",title:"Регистрация",template:"templates/registration.html",styles:"css/registration.css",load:()=>{new e}},{route:"#/choice",title:"Выбор теста",template:"templates/choice.html",styles:"css/choice.css",load:()=>{new s}},{route:"#/test",title:"Тест",template:"templates/test.html",styles:"css/test.css",load:()=>{new n}},{route:"#/result",title:"Результаты",template:"templates/result.html",styles:"css/result.css",load:()=>{new i}},{route:"#/checking",title:"Проверка",template:"templates/answers.html",styles:"css/answers.css",load:()=>{new o}}]}async openRoute(){const e=this.routes.find((e=>e.route===window.location.hash));e?(document.getElementById("content").innerHTML=await fetch(e.template).then((e=>e.text())),document.getElementById("styles").setAttribute("href",e.styles),document.getElementById("page-title").innerHTML=e.title,e.load()):window.location.hash="#/"}}new class{constructor(){this.router=new a,window.addEventListener("DOMContentLoaded",this.handleRouteChanging.bind(this)),window.addEventListener("popstate",this.handleRouteChanging.bind(this))}handleRouteChanging(){this.router.openRoute()}}})();